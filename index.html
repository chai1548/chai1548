<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipping Records</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #4CAF50;
            color: white;
            position: sticky;
            top: 0;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .pagination button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 8px 16px;
            margin: 0 4px;
            cursor: pointer;
            border-radius: 4px;
        }
        .pagination button:hover {
            background-color: #45a049;
        }
        .pagination button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .search-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        #searchInput {
            padding: 10px;
            width: 300px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 700px;
            border-radius: 8px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: black;
        }
        .detail-row {
            margin-bottom: 10px;
            display: flex;
        }
        .detail-label {
            font-weight: bold;
            width: 150px;
        }
        .detail-value {
            flex: 1;
        }
        @media screen and (max-width: 768px) {
            table {
                display: block;
                overflow-x: auto;
            }
            .search-container {
                flex-direction: column;
            }
            #searchInput {
                width: 100%;
                margin-bottom: 10px;
            }
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Shipping Records</h1>
        
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search by account name, phone, or item..." onkeyup="searchTable()">
            <div>
                <span>Show </span>
                <select id="rowsPerPage" onchange="changeRowsPerPage()">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
                <span> entries</span>
            </div>
        </div>
        
        <table id="dataTable">
            <thead>
                <tr>
                    <th>No.</th>
                    <th>Date</th>
                    <th>Code</th>
                    <th>Account Name</th>
                    <th>Phone</th>
                    <th>From</th>
                    <th>To</th>
                    <th>Price (Baht)</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- Data will be loaded here -->
            </tbody>
        </table>
        
        <div class="pagination">
            <button id="prevBtn" onclick="prevPage()" disabled>Previous</button>
            <span id="pageInfo">Page 1 of 1</span>
            <button id="nextBtn" onclick="nextPage()" disabled>Next</button>
        </div>
    </div>
    
    <!-- Detail Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle">Shipping Details</h2>
            <div id="modalContent">
                <!-- Details will be loaded here -->
            </div>
        </div>
    </div>
    
    <script>
        let allData = [];
        let currentPage = 1;
        let rowsPerPage = 10;
        let filteredData = [];
        
        // Fetch data from API
        async function fetchData() {
            try {
                const response = await fetch('https://opensheet.elk.sh/19SPIZrH3EdkPLv3zYHtZVvmnhU-NcHCYUiIpDK3ON4s/10');
                allData = await response.json();
                filteredData = [...allData];
                renderTable();
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('tableBody').innerHTML = '<tr><td colspan="9" style="text-align: center;">Error loading data. Please try again later.</td></tr>';
            }
        }
        
        // Render table with current data
        function renderTable() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const pageData = filteredData.slice(startIndex, endIndex);
            
            if (pageData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center;">No records found</td></tr>';
            } else {
                pageData.forEach(item => {
                    const row = document.createElement('tr');
                    
                    // Helper function to safely get values
                    const getValue = (key) => item[key] || 'N/A';
                    
                    row.innerHTML = `
                        <td>${getValue('No.')}</td>
                        <td>${getValue('Date')}</td>
                        <td>${getValue('Code ').trim()}</td>
                        <td>${getValue('Account Name')}</td>
                        <td>${getValue(' Phone No. ').trim()}</td>
                        <td>${getValue(' Location.from ').trim()}</td>
                        <td>${getValue('Location.to')}</td>
                        <td>${getValue('Price (Baht)')}</td>
                        <td><button onclick="showDetails('${item['No.']}')">View</button></td>
                    `;
                    tableBody.appendChild(row);
                });
            }
            
            updatePagination();
        }
        
        // Update pagination controls
        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages || totalPages === 0;
        }
        
        // Pagination functions
        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
            }
        }
        
        function nextPage() {
            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderTable();
            }
        }
        
        // Change rows per page
        function changeRowsPerPage() {
            rowsPerPage = parseInt(document.getElementById('rowsPerPage').value);
            currentPage = 1;
            renderTable();
        }
        
        // Search function
        function searchTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            if (searchTerm === '') {
                filteredData = [...allData];
            } else {
                filteredData = allData.filter(item => {
                    return (
                        (item['Account Name'] && item['Account Name'].toLowerCase().includes(searchTerm)) ||
                        (item[' Phone No. '] && item[' Phone No. '].toLowerCase().includes(searchTerm)) ||
                        (item[' Item '] && item[' Item '].toLowerCase().includes(searchTerm))
                    );
                });
            }
            
            currentPage = 1;
            renderTable();
        }
        
        // Show details modal
        function showDetails(no) {
            const item = allData.find(i => i['No.'] === no);
            if (!item) return;
            
            const modal = document.getElementById('detailModal');
            document.getElementById('modalTitle').textContent = `Details for Record #${no}`;
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = '';
            
            // Helper function to safely get values
            const getValue = (key) => item[key] || 'N/A';
            
            // Create detail rows
            const fields = [
                {label: 'Date', key: 'Date'},
                {label: 'Code', key: 'Code '},
                {label: 'Account Name', key: 'Account Name'},
                {label: 'Phone No.', key: ' Phone No. '},
                {label: 'From Location', key: ' Location.from '},
                {label: 'To Location', key: 'Location.to'},
                {label: 'Unit', key: ' Unit '},
                {label: 'Item', key: ' Item '},
                {label: 'Receiver', key: " Receiver's Name "},
                {label: 'Price (Baht)', key: 'Price (Baht)'},
                {label: 'Remark', key: 'Remark'}
            ];
            
            fields.forEach(field => {
                const row = document.createElement('div');
                row.className = 'detail-row';
                row.innerHTML = `
                    <div class="detail-label">${field.label}:</div>
                    <div class="detail-value">${getValue(field.key).toString().trim()}</div>
                `;
                modalContent.appendChild(row);
            });
            
            // Show image if available
            if (item['url']) {
                const imgRow = document.createElement('div');
                imgRow.className = 'detail-row';
                imgRow.innerHTML = `
                    <div class="detail-label">Image:</div>
                    <div class="detail-value">
                        <img src="${item['url']}" alt="Shipping item" style="max-width: 100%; max-height: 200px;">
                    </div>
                `;
                modalContent.appendChild(imgRow);
            }
            
            modal.style.display = 'block';
        }
        
        // Close modal
        document.querySelector('.close').addEventListener('click', function() {
            document.getElementById('detailModal').style.display = 'none';
        });
        
        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('detailModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', fetchData);
    </script>
</body>
</html>
